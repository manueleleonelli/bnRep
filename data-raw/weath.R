# Embedding expert opinion in a Bayesian network model to predict wheat yield from spring-summer weather

library(bnlearn)

wheat.dag <- model2network("[MeanTemperature][MaximumTemperature][NDVIinMarch][Rainfall][Yield|MeanTemperature:MaximumTemperature:NDVIinMarch:Rainfall]")

lvMean <- c("Moderate","Other")
lvMax <- c("Low","Medium","High")
lvNDVI <- c("Low","Medium","High","Very High")
lvRain <- c("Dry","Average","Very Wet","Drought and Very Wet")
lvYield <- c("Very Low","Low","Average","High","Very High")

MeanTemperature <- array(c(0.66,0.34),2,list(MeanTemperature=lvMean))
MaximumTemperature <- array(c(0.438,0.25,0.313),3,list(MaximumTemperature=lvMax))
NDVIinMarch <- array(c(0.45,0.45,0.07,0.03),4,list(NDVIinMarch=lvNDVI))
Rainfall <- array(c(0.31,0.24,0.25,0.20),4,list(Rainfall=lvRain))
Yield= array(c(0.1952,	0.3160,	0.4855,	0.0033,	0.0000,
               0.2381,	0.3418,	0.4185,	0.0016,	0.0000,
               0.1750,	0.3006,	0.5197,	0.0047,	0.0000,
               0.2157,	0.3294,	0.4526,	0.0023,	0.0000,
               0.1654,	0.2927,	0.5363,	0.0056,	0.0000,
               0.2050,	0.3227,	0.4695,	0.0028,	0.0000,
               0.2060,	0.3233,	0.4680,	0.0027,	0.0000,
               0.2499,	0.3474,	0.4014,	0.0013,	0.0000,
               0.0013,	0.0093,	0.2927,	0.4821,	0.2146,
               0.0096,	0.0438,	0.5965,	0.3217,	0.0283,
               0.0003,	0.0030,	0.1576,	0.4153,	0.4237,
               0.0036,	0.0205,	0.4352,	0.4456,	0.0952,
               0.0002,	0.0017,	0.1102,	0.3544,	0.5336,
               0.0021,	0.0135,	0.3552,	0.4764,	0.1529,
               0.0025,	0.0154,	0.3792,	0.4697,	0.1333,
               0.0152,	0.0617,	0.6638,	0.2459,	0.0134,
               0.0040,	0.0223,	0.4529,	0.4358,	0.0851,
               0.0215,	0.0793,	0.7038,	0.1886,	0.0069,
               0.0012,	0.0089,	0.2870,	0.4817,	0.2212,
               0.0093,	0.0427,	0.5912,	0.3270,	0.0298,
               0.0007,	0.0054,	0.2183,	0.4615,	0.3142,
               0.0059,	0.0303,	0.5178,	0.3916,	0.0544,
               0.0068,	0.0338,	0.5410,	0.3728,	0.0456,
               0.0317,	0.1045,	0.7319,	0.1291,	0.0029,
               0.1421,	0.2708,	0.5783,	0.0087,	0.0000,
               0.1787,	0.3036,	0.5132,	0.0044,	0.0000,
               0.1253,	0.2529,	0.6097,	0.0122,	0.0000,
               0.1594,	0.2873,	0.5470,	0.0063,	0.0000,
               0.1174,	0.2439,	0.6244,	0.0143,	0.0000,
               0.1504,	0.2789,	0.5632,	0.0074,	0.0000,
               0.1512,	0.2797,	0.5618,	0.0073,	0.0000,
               0.1890,	0.3115,	0.4959,	0.0037,	0.0000,
               0.3166,	0.3686,	0.3143,	0.0005,	0.0000,
               0.3415,	0.3724,	0.2858,	0.0003,	0.0000,
               0.2913,	0.3626,	0.3454,	0.0007,	0.0000,
               0.3329,	0.3713,	0.2954,	0.0004,	0.0000,
               0.2791,	0.3588,	0.3612,	0.0008,	0.0000,
               0.3286,	0.3707,	0.3003,	0.0004,	0.0000,
               0.3297,	0.3709,	0.2990,	0.0004,	0.0000,
               0.3458,	0.3729,	0.2810,	0.0003,	0.0000,
               0.0013,	0.0093,	0.2927,	0.4821,	0.2146,
               0.0096,	0.0438,	0.5965,	0.3217,	0.0283,
               0.0003,	0.0030,	0.1576,	0.4153,	0.4237,
               0.0036,	0.0205,	0.4352,	0.4456,	0.0952,
               0.0002,	0.0017,	0.1102,	0.3544,	0.5336,
               0.0021,	0.0135,	0.3552,	0.4764,	0.1529,
               0.0025,	0.0154,	0.3792,	0.4697,	0.1333,
               0.0152,	0.0617,	0.6638,	0.2459,	0.0134,
               0.0014,	0.0099,	0.3031,	0.4825,	0.2031,
               0.0102,	0.0458,	0.6059,	0.3122,	0.0259,
               0.0004,	0.0033,	0.1651,	0.4228,	0.4084,
               0.0038,	0.0216,	0.4466,	0.4394,	0.0886,
               0.0002,	0.0018,	0.1162,	0.3636,	0.5182,
               0.0023,	0.0143,	0.3663,	0.4736,	0.1436,
               0.0027,	0.0163,	0.3905,	0.4657,	0.1249,
               0.0161,	0.0642,	0.6709,	0.2367,	0.0121,
               0.2485,	0.3468,	0.4034,	0.0014,	0.0000,
               0.2960,	0.3639,	0.3395,	0.0006,	0.0000,
               0.2256,	0.3351,	0.4372,	0.0020,	0.0000,
               0.2713,	0.3561,	0.3716,	0.0009,	0.0000,
               0.2148,	0.3288,	0.4541,	0.0024,	0.0000,
               0.2595,	0.3515,	0.3878,	0.0011,	0.0000,
               0.2605,	0.3519,	0.3864,	0.0011,	0.0000,
               0.3089,	0.3670,	0.3236,	0.0005,	0.0000,
               0.3539,	0.3735,	0.2723,	0.0003,	0.0000,
               0.3620,	0.3740,	0.2637,	0.0002,	0.0000,
               0.3277	, 0.3706,	0.3013,	0.0004,	0.0000,
               0.3533	, 0.3735,	0.2729,	0.0003,	0.0000,
               0.3150,	0.3183,	0.3662,	0.0005,	0.0000,
               0.3490,	0.2776,	0.3731,	0.0003,	0.0000,
               0.3675,	0.3742,	0.2581,	0.0002,	0.0000,
               0.3664,	0.3742,	0.2592,	0.0002,	0.0000,
               0.0040,	0.0223,	0.4529,	0.4358,	0.0851,
               0.0215,	0.0793,	0.7038,	0.1886,	0.0069,
               0.0012,	0.0089,	0.2870,	0.4817,	0.2212,
               0.0093,	0.0427,	0.5912,	0.3270,	0.0298,
               0.0007,	0.0054,	0.2183,	0.4615,	0.3142,
               0.0059,	0.0303,	0.5178,	0.3916,	0.0544,
               0.0068,	0.0338,	0.5410,	0.3728,	0.0456,
               0.0317,	0.1045,	0.7319,	0.1291,	0.0029,
               0.0001,	0.0015,	0.1026,	0.3421,	0.5537,
               0.0019,	0.0124,	0.4407,	0.3793,	0.1657,
               0.0000,	0.0003,	0.0402,	0.2000,	0.7594,
               0.0005,	0.0043,	0.1933,	0.4462,	0.3557,
               0.0000,	0.0001,	0.0237,	0.1425,	0.8337,
               0.0003,	0.0024,	0.1389,	0.3944,	0.4639,
               0.0003,	0.0029,	0.1543,	0.4119,	0.4305,
               0.0034,	0.0200,	0.4302,	0.4482,	0.0982,
               0.3912,	0.3740,	0.2347,	0.0002,	0.0000,
               0.4267,	0.3707,	0.2025,	0.0001,	0.0000,
               0.3823,	0.3743,	0.2433,	0.0002,	0.0000,
               0.4177,	0.3719,	0.2103,	0.0001,	0.0000,
               0.3779,	0.3743,	0.2476,	0.0002,	0.0000,
               0.3724,	0.4132,	0.2143,	0.0001,	0.0000,
               0.3956,	0.3738,	0.2305,	0.0001,	0.0000,
               0.4312,	0.3700,	0.1987,	0.0001,	0.0000),c(5,2,4,4,3),list(Yield=lvYield,MeanTemperature=lvMean,NDVIinMarch=lvNDVI,Rainfall=lvRain,MaximumTemperature=lvMax))
wheat <- custom.fit(wheat.dag,list(MeanTemperature=MeanTemperature,
                                      MaximumTemperature=MaximumTemperature,
                                      NDVIinMarch=NDVIinMarch,
                                      Rainfall=Rainfall,
                                      Yield=Yield))

usethis::use_data(wheat, overwrite = TRUE)
